(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var o in a)e.o(a,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:a[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.hooks,o=window.wp.element,n=window.wp.components,l=window.wp.i18n,r=async(e,t={},a=!1)=>{const o=window.aiforgeDevData||{apiUrl:"/wp-json/aiforge-dev/v1",mainApiUrl:"/wp-json/aiforge/v1",nonce:""},n=`${a?o.mainApiUrl:o.apiUrl}${e}`,l={"Content-Type":"application/json","X-WP-Nonce":o.nonce,...t.headers},r=await fetch(n,{...t,headers:l}),s=await r.json();if(!r.ok||!1===s.success){const e=new Error(s.error?.message||"Une erreur est survenue");throw e.response={data:s},e}return s},s=e=>r("/demo-mode",{method:"POST",body:JSON.stringify({enabled:e})}),i=e=>r("/dev-mode",{method:"POST",body:JSON.stringify({enabled:e})});function d(){var e;const[a,r]=(0,o.useState)(null!==(e=window.aiforgeDevData?.isDemoMode)&&void 0!==e&&e),[i,d]=(0,o.useState)(!1);return(0,t.createElement)(n.ToggleControl,{label:(0,l.__)("Mode démo","ai-forge-devtools"),checked:a,onChange:async e=>{d(!0);try{await s(e),window.location.reload()}catch(e){console.error("Failed to toggle demo mode:",e),d(!1)}},disabled:i,__nextHasNoMarginBottom:!0})}function c(){var e;const[a,r]=(0,o.useState)(null!==(e=window.aiforgeDevData?.isDevMode)&&void 0!==e&&e),[s,d]=(0,o.useState)(!1);return(0,t.createElement)(n.ToggleControl,{label:(0,l.__)("Mode dev","ai-forge-devtools"),checked:a,onChange:async e=>{d(!0);try{await i(e),window.location.reload()}catch(e){console.error("Failed to toggle dev mode:",e),d(!1)}},disabled:s,__nextHasNoMarginBottom:!0})}function m(){return(0,t.createElement)("div",{className:"aiforge-demo-notice"},(0,t.createElement)("span",{className:"dashicons dashicons-info"}),(0,l.__)("Mode démo actif : les services sont simulés, aucun appel externe.","ai-forge-devtools"))}function g(){const[e,r]=(0,o.useState)(window.aiforgeDevState?.lastPrompt||null),[s,i]=(0,o.useState)(!1);return(0,o.useEffect)(()=>((0,a.addAction)("aiforge.agent.result","aiforge-devtools/prompt-debugger-update",e=>{e?.meta?.debug?.prompt&&r(e.meta.debug.prompt)}),()=>{(0,a.removeAction)("aiforge.agent.result","aiforge-devtools/prompt-debugger-update")}),[]),e?(0,t.createElement)("div",{className:"aiforge-prompt-debugger"},(0,t.createElement)("div",{className:"aiforge-prompt-debugger__header"},(0,t.createElement)("h3",null,(0,l.__)("Prompt envoyé","ai-forge-devtools")),(0,t.createElement)(n.Button,{variant:"secondary",size:"small",onClick:async()=>{try{await navigator.clipboard.writeText(e),i(!0),setTimeout(()=>i(!1),2e3)}catch(e){console.error("Failed to copy:",e)}},icon:s?"yes":"clipboard"},s?(0,l.__)("Copié !","ai-forge-devtools"):(0,l.__)("Copier","ai-forge-devtools"))),(0,t.createElement)("pre",{className:"aiforge-prompt-debugger__code"},(0,t.createElement)("code",null,e))):null}const p=window.wp.apiFetch;var u=e.n(p);const v=function({content:e,className:a=""}){const[r,s]=(0,o.useState)(!1);return(0,t.createElement)(n.Button,{variant:"secondary",size:"small",onClick:async()=>{try{await navigator.clipboard.writeText(e),s(!0),setTimeout(()=>s(!1),2e3)}catch(e){console.error("Failed to copy:",e)}},className:`copy-button ${a}`,icon:r?"yes":"clipboard"},r?(0,l.__)("Copié !","ai-forge-devtools"):(0,l.__)("Copier","ai-forge-devtools"))},f=[{id:null,label:(0,l.__)("Sans addenda","ai-forge-devtools"),icon:"editor-code"},{id:"gemini",label:"Gemini",icon:"cloud"},{id:"openai",label:"OpenAI",icon:"cloud"},{id:"anthropic",label:"Claude",icon:"cloud"}];function _(e){return e.children&&0!==e.children.length?e.children.find(e=>"llm_generate"===e.task_type):null}function w(e){const a=function(e){const t=[];return e.logs&&e.logs.length>0&&e.logs.forEach(a=>{t.push({...a,taskType:e.task_type,taskId:e.id})}),e.children&&e.children.length>0&&e.children.forEach(e=>{e.logs&&e.logs.length>0&&e.logs.forEach(a=>{t.push({...a,taskType:e.task_type,taskId:e.id})})}),t.sort((e,t)=>new Date(e.created_at)-new Date(t.created_at)),t}(e);return 0===a.length?(0,t.createElement)("div",{className:"task-detail-modal__empty"},(0,t.createElement)("p",null,(0,l.__)("Aucun log disponible","ai-forge-devtools"))):(0,t.createElement)("div",{className:"task-detail-modal__logs"},a.map((e,a)=>{return(0,t.createElement)("div",{key:a,className:`task-log task-log--${e.level}`},(0,t.createElement)("span",{className:"task-log__level"},"[",e.level,"]"),(0,t.createElement)("span",{className:"task-log__task-type"},"[",{batch_markdown_to_gutenberg:"Batch",markdown_to_gutenberg:"M→G",llm_generate:"LLM",wp_create_draft:"Draft"}[n=e.taskType]||n,"]"),(0,t.createElement)("span",{className:"task-log__message"},e.message),(0,t.createElement)("span",{className:"task-log__time"},(o=e.created_at)?new Date(o).toLocaleString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-"));var o,n}))}function y(e){const a=_(e),o=a?.payloads||e.payloads||[];return 0===o.length?(0,t.createElement)("div",{className:"task-detail-modal__empty"},(0,t.createElement)("p",null,(0,l.__)("Aucun payload disponible","ai-forge-devtools"))):(0,t.createElement)("div",{className:"task-detail-modal__payloads"},o.map((e,a)=>(0,t.createElement)("div",{key:a,className:"task-detail-modal__code-block"},(0,t.createElement)("div",{className:"task-detail-modal__code-header"},(0,t.createElement)("strong",null,e.type),(0,t.createElement)(v,{content:e.payload})),(0,t.createElement)("pre",{className:"task-detail-modal__code"},e.payload))))}function b(e){const a=_(e),o=a?.meta||e.meta||{};return 0===Object.keys(o).length?(0,t.createElement)("div",{className:"task-detail-modal__empty"},(0,t.createElement)("p",null,(0,l.__)("Aucune métadonnée disponible","ai-forge-devtools"))):(0,t.createElement)("div",{className:"task-detail-modal__meta"},(0,t.createElement)("table",{className:"task-meta-table"},(0,t.createElement)("tbody",null,Object.entries(o).map(([e,a])=>(0,t.createElement)("tr",{key:e},(0,t.createElement)("td",{className:"task-meta-table__key"},e),(0,t.createElement)("td",{className:"task-meta-table__value"},"object"==typeof a?JSON.stringify(a,null,2):String(a)))))))}function k({taskId:e}){const[a,r]=(0,o.useState)(!1),[s,i]=(0,o.useState)(!1),[d,c]=(0,o.useState)(null);return(0,t.createElement)(n.Dropdown,{popoverProps:{placement:"bottom-end"},renderToggle:({isOpen:e,onToggle:o})=>(0,t.createElement)(n.Button,{variant:"secondary",icon:s?"yes":"clipboard",onClick:o,"aria-expanded":e,disabled:a},s?(0,l.__)("Copié !","ai-forge-devtools"):(0,l.__)("Copier le prompt","ai-forge-devtools")),renderContent:({onClose:o})=>(0,t.createElement)(n.MenuGroup,null,f.map(l=>(0,t.createElement)(n.MenuItem,{key:l.id||"base",icon:l.icon,onClick:()=>(async(t,a)=>{r(!0),c(t);try{const a=t?`?provider=${t}`:"",o=await u()({path:`/aiforge/v1/tasks/${e}/prompt${a}`});o.success&&o.data?.prompt&&(await navigator.clipboard.writeText(o.data.prompt),i(!0),setTimeout(()=>{i(!1),c(null)},2e3))}catch(e){console.error("Failed to fetch/copy prompt:",e)}finally{r(!1),a()}})(l.id,o),disabled:a&&d===l.id},l.label)))})}window.aiforgeDevState=window.aiforgeDevState||{},(0,a.addAction)("aiforge.agent.result","aiforge-devtools/store-prompt",e=>{e?.meta?.debug?.prompt&&(window.aiforgeDevState.lastPrompt=e.meta.debug.prompt)}),(0,a.addFilter)("aiforge.app.headerTools","aiforge-devtools/header-toggles",()=>(0,t.createElement)("div",{className:"aiforge-devtools-toggles"},(0,t.createElement)(d,null),(0,t.createElement)(c,null))),(0,a.addFilter)("aiforge.settings.services.beforeContent","aiforge-devtools/demo-notice",e=>{var a;return null!==(a=window.aiforgeDevData?.isDemoMode)&&void 0!==a&&a?(0,t.createElement)(t.Fragment,null,(0,t.createElement)(m,null),e):e}),(0,a.addFilter)("aiforge.screen.afterContent","aiforge-devtools/prompt-debugger",(e,a)=>{var o;return null!==(o=window.aiforgeDevData?.isDevMode)&&void 0!==o&&o&&"content-integrator"===a?.screen?(0,t.createElement)(t.Fragment,null,e,(0,t.createElement)(g,null)):e}),(0,a.addFilter)("aiforge.taskDetailModal.tabs","aiforge-devtools/task-detail-tabs",function(e,t){var a;if(null===(a=window.aiforgeDevData?.isDevMode)||void 0===a||!a)return e;const{task:o}=t;return e.push({name:"logs",title:(0,l.__)("Logs","ai-forge-devtools"),content:w(o)}),e.push({name:"payloads",title:(0,l.__)("Payloads","ai-forge-devtools"),content:y(o)}),e.push({name:"meta",title:(0,l.__)("Métadonnées","ai-forge-devtools"),content:b(o)}),e}),(0,a.addFilter)("aiforge.taskDetailModal.footerActions","aiforge-devtools/task-detail-footer-actions",function(e,a){var o;if(null===(o=window.aiforgeDevData?.isDevMode)||void 0===o||!o)return e;const{task:n}=a;return"markdown_to_gutenberg"!==n.task_type?e:_(n)?(e.push((0,t.createElement)(k,{key:"copy-prompt",taskId:n.id})),e):e})})();