(()=>{"use strict";const e=window.React,t=window.wp.element,a=window.wp.i18n,n=window.wp.components,s=async(e,t={},a=!1)=>{const n=window.aiforgeDevData||{apiUrl:"/wp-json/aiforge-dev/v1",mainApiUrl:"/wp-json/aiforge/v1",nonce:""},s=`${a?n.mainApiUrl:n.apiUrl}${e}`,r={"Content-Type":"application/json","X-WP-Nonce":n.nonce,...t.headers},o=await fetch(s,{...t,headers:r}),l=await o.json();if(!o.ok||!1===l.success){const e=new Error(l.error?.message||"Une erreur est survenue");throw e.response={data:l},e}return l},r=(e,t,a="")=>s("/sanitizer/test",{method:"POST",body:JSON.stringify({markdown:e,content:t,template:a})}),o=()=>s("/ci-templates",{},!0),l=e=>s(`/ci-templates/${e}`,{},!0),i=function({content:s,className:r=""}){const[o,l]=(0,t.useState)(!1);return(0,e.createElement)(n.Button,{variant:"secondary",size:"small",onClick:async()=>{try{await navigator.clipboard.writeText(s),l(!0),setTimeout(()=>l(!1),2e3)}catch(e){console.error("Failed to copy:",e)}},className:`copy-button ${r}`,icon:o?"yes":"clipboard"},o?(0,a.__)("Copié !","ai-forge-devtools"):(0,a.__)("Copier","ai-forge-devtools"))};function c({result:t}){const{sanitized:s,changes:r,has_changes:o}=t;return(0,e.createElement)("div",{className:"sanitizer-tester__result"},(0,e.createElement)("div",{className:"sanitizer-tester__panel sanitizer-tester__panel--result"},(0,e.createElement)("div",{className:"sanitizer-tester__panel-header"},(0,e.createElement)("span",{className:"dashicons dashicons-yes-alt"}),(0,e.createElement)("span",null,(0,a.__)("Résultat","ai-forge-devtools")),(0,e.createElement)(i,{content:s})),(0,e.createElement)("div",{className:"sanitizer-tester__panel-body"},o?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"sanitizer-tester__changes"},(0,e.createElement)(n.Notice,{status:"warning",isDismissible:!1},r.length," ",1===r.length?(0,a.__)("correction effectuée","ai-forge-devtools"):(0,a.__)("corrections effectuées","ai-forge-devtools")),(0,e.createElement)("ul",{className:"sanitizer-tester__changes-list"},r.map((t,n)=>(0,e.createElement)("li",{key:n},(e=>"heading_level"===e.type?`Heading "${e.text}" : level ${e.from} → ${e.to}`:"list_type"===e.type?`List : type ${e.from} → ${e.to}`:"list_items_wrapped"===e.type?`List : ${e.count} items wrapped in wp:list-item`:"preamble_stripped"===e.type?`Preamble stripped: "${e.content}${e.content.length>=100?"...":""}"`:"postamble_stripped"===e.type?`Postamble stripped: "${e.content}${e.content.length>=100?"...":""}"`:"empty_paragraphs_removed"===e.type?`${e.count} empty paragraph${e.count>1?"s":""} removed`:"lorem_ipsum_removed"===e.type?`${e.count} lorem ipsum block${e.count>1?"s":""} removed`:"quote_citation_synced"===e.type?`Quote citation synced: "${e.citation}"`:"attribute_added"===e.type?`${e.block} : ajout attribut "${e.attribute}"`:"heading_attrs_normalized"===e.type?(0,a.__)("Heading : attributs et classes réordonnés","ai-forge-devtools"):"cover_dim_class_added"===e.type?(0,a.__)("Cover : classe has-background-dim ajoutée","ai-forge-devtools"):"empty_containers_removed"===e.type?`${e.count} ${e.count>1?(0,a.__)("conteneurs vides supprimés","ai-forge-devtools"):(0,a.__)("conteneur vide supprimé","ai-forge-devtools")}`:"orphaned_tags_cleaned"===e.type?`${e.count} ${e.count>1?(0,a.__)("balises orphelines nettoyées","ai-forge-devtools"):(0,a.__)("balise orpheline nettoyée","ai-forge-devtools")}`:JSON.stringify(e))(t))))),(0,e.createElement)("pre",{className:"sanitizer-tester__code"},(0,e.createElement)("code",null,s))):(0,e.createElement)(n.Notice,{status:"success",isDismissible:!1},(0,a.__)("Aucune correction nécessaire - le contenu est valide.","ai-forge-devtools")))))}const d=function(){const[s,i]=(0,t.useState)(""),[d,m]=(0,t.useState)(""),[u,_]=(0,t.useState)(""),[p,v]=(0,t.useState)([]),[g,f]=(0,t.useState)(""),[E,h]=(0,t.useState)(!1),[y,b]=(0,t.useState)(null),[N,w]=(0,t.useState)(!1),[z,$]=(0,t.useState)(null);return(0,t.useEffect)(()=>{(async()=>{try{const e=await o();v(e.data||[])}catch(e){}})()},[]),(0,e.createElement)("div",{className:"sanitizer-tester"},(0,e.createElement)("div",{className:"sanitizer-tester__section-title"},(0,e.createElement)("span",{className:"dashicons dashicons-admin-tools"}),(0,a.__)("Test du GutenbergSanitizer","ai-forge-devtools")),z&&(0,e.createElement)(n.Notice,{status:"error",isDismissible:!0,onDismiss:()=>$(null)},z),(0,e.createElement)("div",{className:"sanitizer-tester__inputs"},(0,e.createElement)("div",{className:"sanitizer-tester__panel"},(0,e.createElement)("div",{className:"sanitizer-tester__panel-header"},(0,e.createElement)("span",{className:"dashicons dashicons-editor-code"}),(0,e.createElement)("span",null,(0,a.__)("Source Markdown","ai-forge-devtools"))),(0,e.createElement)("div",{className:"sanitizer-tester__panel-body"},(0,e.createElement)("textarea",{value:s,onChange:e=>i(e.target.value),placeholder:(0,a.__)("Collez le markdown source ici...","ai-forge-devtools"),disabled:N}))),(0,e.createElement)("div",{className:"sanitizer-tester__panel"},(0,e.createElement)("div",{className:"sanitizer-tester__panel-header"},(0,e.createElement)("span",{className:"dashicons dashicons-html"}),(0,e.createElement)("span",null,(0,a.__)("Contenu Gutenberg","ai-forge-devtools"))),(0,e.createElement)("div",{className:"sanitizer-tester__panel-body"},(0,e.createElement)("textarea",{value:d,onChange:e=>m(e.target.value),placeholder:(0,a.__)("Collez le contenu Gutenberg généré ici...","ai-forge-devtools"),disabled:N}))),(0,e.createElement)("div",{className:"sanitizer-tester__panel sanitizer-tester__panel--optional"},(0,e.createElement)("div",{className:"sanitizer-tester__panel-header"},(0,e.createElement)("span",{className:"dashicons dashicons-layout"}),(0,e.createElement)("span",null,(0,a.__)("Template (optionnel)","ai-forge-devtools")),E&&(0,e.createElement)(n.Spinner,null)),(0,e.createElement)("div",{className:"sanitizer-tester__panel-body"},p.length>0&&(0,e.createElement)(n.SelectControl,{value:g,options:[{value:"",label:(0,a.__)("— Sélectionner un template —","ai-forge-devtools")},...p.map(e=>({value:String(e.id),label:e.title}))],onChange:async e=>{if(f(e),e){h(!0);try{const t=await l(e),a=t.data?.content||t.data?.neutralized_content||"";_(a)}catch(e){$((0,a.__)("Erreur lors du chargement du template.","ai-forge-devtools"))}finally{h(!1)}}},disabled:N||E,__nextHasNoMarginBottom:!0}),(0,e.createElement)("textarea",{value:u,onChange:e=>{_(e.target.value),f("")},placeholder:(0,a.__)("Collez le template Gutenberg pour tester le shift down des titres...","ai-forge-devtools"),disabled:N||E})))),(0,e.createElement)("div",{className:"sanitizer-tester__actions"},(0,e.createElement)(n.Button,{variant:"primary",onClick:async()=>{if(d.trim())if(s.trim()){w(!0),$(null),b(null);try{const e=await r(s,d,u);b(e.data)}catch(e){$(e.message||(0,a.__)("Une erreur est survenue.","ai-forge-devtools"))}finally{w(!1)}}else $((0,a.__)("Le contenu Markdown est requis.","ai-forge-devtools"));else $((0,a.__)("Le contenu Gutenberg est requis.","ai-forge-devtools"))},disabled:N||!d.trim()||!s.trim()},N?(0,e.createElement)(e.Fragment,null,(0,e.createElement)(n.Spinner,null),(0,a.__)("Analyse en cours...","ai-forge-devtools")):(0,a.__)("Tester la sanitization","ai-forge-devtools")),(0,e.createElement)(n.Button,{variant:"secondary",onClick:()=>{i(""),m(""),_(""),f(""),b(null),$(null)},disabled:N},(0,a.__)("Effacer","ai-forge-devtools"))),y&&(0,e.createElement)(c,{result:y}))},m=function(){return(0,e.createElement)("div",{className:"aiforge-developer-page__content"},(0,e.createElement)("h1",null,(0,a.__)("Outils de développement","ai-forge-devtools")),(0,e.createElement)(d,null))};document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("aiforge-dev-root");a&&(0,t.createRoot)(a).render((0,e.createElement)(m,null))})})();