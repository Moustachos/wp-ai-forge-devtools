(()=>{"use strict";const e=window.React,t=window.wp.element,a=window.wp.i18n,s=window.wp.components,n=async(e,t={},a=!1)=>{const s=window.aiforgeDevData||{apiUrl:"/wp-json/aiforge-dev/v1",mainApiUrl:"/wp-json/aiforge/v1",nonce:""},n=`${a?s.mainApiUrl:s.apiUrl}${e}`,o={"Content-Type":"application/json","X-WP-Nonce":s.nonce,...t.headers},l=await fetch(n,{...t,headers:o}),r=await l.json();if(!l.ok||!1===r.success){const e=new Error(r.error?.message||"Une erreur est survenue");throw e.response={data:r},e}return r},o=(e,t,a="")=>n("/sanitizer/test",{method:"POST",body:JSON.stringify({markdown:e,content:t,template:a})}),l=()=>n("/license-scenario"),r=e=>n("/license-scenario",{method:"POST",body:JSON.stringify({scenario:e})}),i=()=>n("/ci-templates",{},!0),c=e=>n(`/ci-templates/${e}`,{},!0),d=function({content:n,className:o=""}){const[l,r]=(0,t.useState)(!1);return(0,e.createElement)(s.Button,{variant:"secondary",size:"small",onClick:async()=>{try{await navigator.clipboard.writeText(n),r(!0),setTimeout(()=>r(!1),2e3)}catch(e){console.error("Failed to copy:",e)}},className:`copy-button ${o}`,icon:l?"yes":"clipboard"},l?(0,a.__)("Copié !","ai-forge-devtools"):(0,a.__)("Copier","ai-forge-devtools"))};function m({result:t}){const{sanitized:n,changes:o,has_changes:l}=t;return(0,e.createElement)("div",{className:"sanitizer-tester__result"},(0,e.createElement)("div",{className:"sanitizer-tester__panel sanitizer-tester__panel--result"},(0,e.createElement)("div",{className:"sanitizer-tester__panel-header"},(0,e.createElement)("span",{className:"dashicons dashicons-yes-alt"}),(0,e.createElement)("span",null,(0,a.__)("Résultat","ai-forge-devtools")),(0,e.createElement)(d,{content:n})),(0,e.createElement)("div",{className:"sanitizer-tester__panel-body"},l?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"sanitizer-tester__changes"},(0,e.createElement)(s.Notice,{status:"warning",isDismissible:!1},o.length," ",1===o.length?(0,a.__)("correction effectuée","ai-forge-devtools"):(0,a.__)("corrections effectuées","ai-forge-devtools")),(0,e.createElement)("ul",{className:"sanitizer-tester__changes-list"},o.map((t,s)=>(0,e.createElement)("li",{key:s},(e=>"heading_level"===e.type?`Heading "${e.text}" : level ${e.from} → ${e.to}`:"list_type"===e.type?`List : type ${e.from} → ${e.to}`:"list_items_wrapped"===e.type?`List : ${e.count} items wrapped in wp:list-item`:"preamble_stripped"===e.type?`Preamble stripped: "${e.content}${e.content.length>=100?"...":""}"`:"postamble_stripped"===e.type?`Postamble stripped: "${e.content}${e.content.length>=100?"...":""}"`:"empty_paragraphs_removed"===e.type?`${e.count} empty paragraph${e.count>1?"s":""} removed`:"lorem_ipsum_removed"===e.type?`${e.count} lorem ipsum block${e.count>1?"s":""} removed`:"quote_citation_synced"===e.type?`Quote citation synced: "${e.citation}"`:"attribute_added"===e.type?`${e.block} : ajout attribut "${e.attribute}"`:"heading_attrs_normalized"===e.type?(0,a.__)("Heading : attributs et classes réordonnés","ai-forge-devtools"):"cover_dim_class_added"===e.type?(0,a.__)("Cover : classe has-background-dim ajoutée","ai-forge-devtools"):"column_width_synced"===e.type?`Column : flex-basis:${e.width} synchronisé`:"figcaption_class_fixed"===e.type?(0,a.__)("Image : figcaption class corrigée","ai-forge-devtools"):"empty_containers_removed"===e.type?`${e.count} ${e.count>1?(0,a.__)("conteneurs vides supprimés","ai-forge-devtools"):(0,a.__)("conteneur vide supprimé","ai-forge-devtools")}`:"orphaned_tags_cleaned"===e.type?`${e.count} ${e.count>1?(0,a.__)("balises orphelines nettoyées","ai-forge-devtools"):(0,a.__)("balise orpheline nettoyée","ai-forge-devtools")}`:"missing_tags_added"===e.type?`${e.count} ${e.count>1?(0,a.__)("balises manquantes ajoutées","ai-forge-devtools"):(0,a.__)("balise manquante ajoutée","ai-forge-devtools")}`:JSON.stringify(e))(t))))),(0,e.createElement)("pre",{className:"sanitizer-tester__code"},(0,e.createElement)("code",null,n))):(0,e.createElement)(s.Notice,{status:"success",isDismissible:!1},(0,a.__)("Aucune correction nécessaire - le contenu est valide.","ai-forge-devtools")))))}const _=function(){const[n,l]=(0,t.useState)(""),[r,d]=(0,t.useState)(""),[_,u]=(0,t.useState)(""),[p,v]=(0,t.useState)([]),[g,f]=(0,t.useState)(""),[E,h]=(0,t.useState)(!1),[y,b]=(0,t.useState)(null),[N,w]=(0,t.useState)(!1),[z,S]=(0,t.useState)(null);return(0,t.useEffect)(()=>{(async()=>{try{const e=await i();v(e.data||[])}catch(e){}})()},[]),(0,e.createElement)("section",{className:"aiforge-dev-section"},(0,e.createElement)("div",{className:"aiforge-dev-section__header"},(0,e.createElement)("span",{className:"dashicons dashicons-admin-tools"}),(0,e.createElement)("div",null,(0,e.createElement)("h2",null,(0,a.__)("Test du GutenbergSanitizer","ai-forge-devtools")),(0,e.createElement)("p",null,(0,a.__)("Testez la sanitization du contenu Gutenberg avec le markdown source.","ai-forge-devtools")))),(0,e.createElement)("div",{className:"aiforge-dev-section__body sanitizer-tester"},z&&(0,e.createElement)(s.Notice,{status:"error",isDismissible:!0,onDismiss:()=>S(null)},z),(0,e.createElement)("div",{className:"sanitizer-tester__inputs"},(0,e.createElement)("div",{className:"sanitizer-tester__panel"},(0,e.createElement)("div",{className:"sanitizer-tester__panel-header"},(0,e.createElement)("span",{className:"dashicons dashicons-editor-code"}),(0,e.createElement)("span",null,(0,a.__)("Source Markdown","ai-forge-devtools"))),(0,e.createElement)("div",{className:"sanitizer-tester__panel-body"},(0,e.createElement)("textarea",{value:n,onChange:e=>l(e.target.value),placeholder:(0,a.__)("Collez le markdown source ici...","ai-forge-devtools"),disabled:N}))),(0,e.createElement)("div",{className:"sanitizer-tester__panel"},(0,e.createElement)("div",{className:"sanitizer-tester__panel-header"},(0,e.createElement)("span",{className:"dashicons dashicons-html"}),(0,e.createElement)("span",null,(0,a.__)("Contenu Gutenberg","ai-forge-devtools"))),(0,e.createElement)("div",{className:"sanitizer-tester__panel-body"},(0,e.createElement)("textarea",{value:r,onChange:e=>d(e.target.value),placeholder:(0,a.__)("Collez le contenu Gutenberg généré ici...","ai-forge-devtools"),disabled:N}))),(0,e.createElement)("div",{className:"sanitizer-tester__panel sanitizer-tester__panel--optional"},(0,e.createElement)("div",{className:"sanitizer-tester__panel-header"},(0,e.createElement)("span",{className:"dashicons dashicons-layout"}),(0,e.createElement)("span",null,(0,a.__)("Template (optionnel)","ai-forge-devtools")),E&&(0,e.createElement)(s.Spinner,null)),(0,e.createElement)("div",{className:"sanitizer-tester__panel-body"},p.length>0&&(0,e.createElement)(s.SelectControl,{value:g,options:[{value:"",label:(0,a.__)("— Sélectionner un template —","ai-forge-devtools")},...p.map(e=>({value:String(e.id),label:e.title}))],onChange:async e=>{if(f(e),e){h(!0);try{const t=await c(e),a=t.data?.content||t.data?.neutralized_content||"";u(a)}catch(e){S((0,a.__)("Erreur lors du chargement du template.","ai-forge-devtools"))}finally{h(!1)}}},disabled:N||E,__nextHasNoMarginBottom:!0}),(0,e.createElement)("textarea",{value:_,onChange:e=>{u(e.target.value),f("")},placeholder:(0,a.__)("Collez le template Gutenberg pour tester le shift down des titres...","ai-forge-devtools"),disabled:N||E})))),(0,e.createElement)("div",{className:"sanitizer-tester__actions"},(0,e.createElement)(s.Button,{variant:"primary",onClick:async()=>{if(r.trim())if(n.trim()){w(!0),S(null),b(null);try{const e=await o(n,r,_);b(e.data)}catch(e){S(e.message||(0,a.__)("Une erreur est survenue.","ai-forge-devtools"))}finally{w(!1)}}else S((0,a.__)("Le contenu Markdown est requis.","ai-forge-devtools"));else S((0,a.__)("Le contenu Gutenberg est requis.","ai-forge-devtools"))},disabled:N||!r.trim()||!n.trim()},N?(0,e.createElement)(e.Fragment,null,(0,e.createElement)(s.Spinner,null),(0,a.__)("Analyse en cours...","ai-forge-devtools")):(0,a.__)("Tester la sanitization","ai-forge-devtools")),(0,e.createElement)(s.Button,{variant:"secondary",onClick:()=>{l(""),d(""),u(""),f(""),b(null),S(null)},disabled:N},(0,a.__)("Effacer","ai-forge-devtools"))),y&&(0,e.createElement)(m,{result:y})))},u={valid:(0,a.__)("Licence valide","ai-forge-devtools"),expired:(0,a.__)("Licence expirée","ai-forge-devtools"),invalid:(0,a.__)("Clé invalide","ai-forge-devtools"),update_available:(0,a.__)("Mise à jour disponible","ai-forge-devtools")};function p(){const[n,o]=(0,t.useState)("valid"),[i,c]=(0,t.useState)("valid"),[d,m]=(0,t.useState)(!0),[_,p]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{const e=await l();o(e.data.scenario),c(e.data.scenario)}catch(e){console.error("Failed to load license scenario:",e)}finally{m(!1)}})()},[]);const v=Object.entries(u).map(([e,t])=>({value:e,label:t}));return(0,e.createElement)("section",{className:"aiforge-dev-section"},(0,e.createElement)("div",{className:"aiforge-dev-section__header"},(0,e.createElement)("span",{className:"dashicons dashicons-shield"}),(0,e.createElement)("div",null,(0,e.createElement)("h2",null,(0,a.__)("Scénario licence","ai-forge-devtools")),(0,e.createElement)("p",null,(0,a.__)("Simule les réponses du serveur de licence pour tester les différents états.","ai-forge-devtools")))),(0,e.createElement)("div",{className:"aiforge-dev-section__body"},(0,e.createElement)("div",{className:"aiforge-dev-license-scenario__controls"},(0,e.createElement)(s.SelectControl,{value:i,options:v,onChange:c,disabled:d,__nextHasNoMarginBottom:!0}),(0,e.createElement)(s.Button,{variant:"secondary",onClick:async()=>{p(!0);try{const e=await r(i);o(e.data.scenario)}catch(e){console.error("Failed to set license scenario:",e)}finally{p(!1)}},isBusy:_,disabled:_||d||i===n},(0,a.__)("Appliquer","ai-forge-devtools"))),!d&&i!==n&&(0,e.createElement)("p",{className:"aiforge-dev-license-scenario__hint"},(0,a.__)("Scénario modifié, cliquez sur Appliquer pour confirmer.","ai-forge-devtools"))))}const v=function(){return(0,e.createElement)("div",{className:"aiforge-developer-page__content"},(0,e.createElement)("div",{className:"aiforge-developer-page__header"},(0,e.createElement)("span",{className:"dashicons dashicons-code-standards"}),(0,e.createElement)("div",null,(0,e.createElement)("h1",null,(0,a.__)("Outils de développement","ai-forge-devtools")),(0,e.createElement)("p",null,(0,a.__)("Simulez des scénarios et testez les composants internes d'AI Forge.","ai-forge-devtools")))),(0,e.createElement)("div",{className:"aiforge-developer-page__sections"},(0,e.createElement)(p,null),(0,e.createElement)(_,null)))};document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("aiforge-dev-root");a&&(0,t.createRoot)(a).render((0,e.createElement)(v,null))})})();